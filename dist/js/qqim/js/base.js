"use strict";var continueAnswer=!0;function jsonpCallback(e){webim.setJsonpLastRspData(e)}function initHistoryMsg(e,t){if(1==t){for(var o=0;o<=e.length-1;o++){var n=JSON.parse(e[o]);webim.Log.warn("receive a new avchatroom group msg: "+n.fromAccountNick),-1<JSON.stringify(n).search(/.*CMD.*product.*/i)||(n.elems[0].content.text&&(n.elems[0].content.text=n.elems[0].content.text.replace(/((http:\/\/|https:\/\/)[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/gi,"<a href='$1'>$1</a>")),showHistoryBeforeMsg(n))}$("#chat-list-div").animate({scrollTop:2}),ismousewheel=!0}else for(o=e.length-1;0<=o;o--){n=JSON.parse(e[o]);webim.Log.warn("receive a new avchatroom group msg: "+n.fromAccountNick),-1<JSON.stringify(n).search(/.*CMD.*product.*/i)||(n.elems[0].content.text&&(n.elems[0].content.text=n.elems[0].content.text.replace(/((http:\/\/|https:\/\/)[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/gi,"<a href='$1'>$1</a>")),showHistoryMsg(n))}}function onBigGroupMsgNotify(e){for(var t=e.length-1;0<=t;t--){var o=e[t];webim.Log.warn("receive a new avchatroom group msg: "+o.getFromAccountNick()),o.getSubType()!=webim.GROUP_MSG_SUB_TYPE.TIP&&(console.log(o),"TIMCustomElem"==o.elems[0].type?showOptions(o):($.ajax({type:"get",url:getnickname,data:{fromAccount:o.fromAccount},dataType:"json",async:!1,success:function(e){0==e.state&&(o.fromAccountNick=e.nickName)}}),showMsg(o)))}}function showOptions(e){var t=e.getElems(),o=(t[0].getType(),t[0].getContent()),i=(convertCustomMsgToHtml(o),o.getData()),n=o.getDesc();if("ANSWER"==o.getExt()){var r=function(e){$("#promoteProduct").css("display","none"),document.getElementById("videoContainer").ontouchstart=null,e.preventDefault(),document.getElementById("productUrl").style.display="none",document.getElementById("videoContainer").style.width="100%",document.getElementById("videoContainer").style.height="3.2rem",document.getElementById("videoContainer").style.position="absolute",document.getElementById("videoContainer").style.left="0",document.getElementById("videoContainer").style.top="0.98rem",document.getElementById("videoContainer").style.zIndex="999",document.getElementById("videoContainer").style.background=null,$("#videos").css({position:"static",width:"100%",height:"100%"}),$("#dragMove").css("display","none"),document.getElementById("videos").setAttribute("height","100%"),document.getElementById("videos").setAttribute("controls",""),document.getElementById("close").style.display="none",$("#Interactive").css("display","none")};$("#errorenter").on("click",function(){$("#errorAnswer").css("display","none"),$("#Interactive").css("display","none"),$("#close").trigger("click")}),$("#correctenter").click(function(){$("#correctAnswer").css("display","none"),$("#Interactive").css("display","none"),$("#close").trigger("click")}),console.log(i),console.log(n),console.log(JSON.parse(n));var s,c=questionData[JSON.parse(n).questionNumber],a=JSON.parse(n).questionNumber+1;console.log(c);var l=c.q_title;$(".question span").html(l),$(".countdown").html(10),$(".number").html(a);var m="";$(".answer").empty();for(var d=0;d<c.options.length;d++)m+=' <p class="answerOne"><i class="weixuanzhong"></i><span>'+c.options[d].o_desc+"</span></p>";$(".answer").append(m),continueAnswer?$(".answer").on("click",".weixuanzhong",function(){$(".weixuanzhong").removeClass("xuanzhong"),$(this).addClass("xuanzhong")}):($(".answer").off("click",".weixuanzhong"),$(".answer").on("click",".weixuanzhong",function(){$("#errorMessage").html("您已经被淘汰可以继续观赛"),$("#Interactive").css("display","block"),$("#errorenter").off("click"),$("#errorenter").click(function(){$("#errorAnswer").css("display","none")})})),$("#close").css({display:"block",width:"59px",height:"59px",position:"absolute",left:"87px",top:"14px",background:"url(./img/moveBack.png) no-repeat center center",backgroundSize:"100% 100%"}),$("#dragMove").css({display:"block",width:"59px",height:"59px",position:"absolute",left:"87px",bottom:"31px",background:"url(./img/movedrag.png) no-repeat center center",backgroundSize:"100% 100%"}),$("#videoContainer").css({width:"232px",height:"288px",background:"url(./img/moveBG.png) ",backgroundPosition:"0 0",backgroundSize:"100% 100%",position:"absolute",left:"150px",top:"300px",zIndex:"9999"}),$("#videos").css({width:"205px",height:"134px",position:"absolute",left:"13px",top:"69px"}),document.getElementById("videos").setAttribute("height","60%"),document.getElementById("videos").removeAttribute("controls"),$("#close").bind("click",r),document.getElementById("dragMove").ontouchstart=function(e){document.body.ontouchmove=function(e){e.preventDefault()},$("#close").unbind("click",r);var n=document.getElementById("videoContainer"),e=e||window.event;console.log(e);var i=e.touches[0].clientX-n.offsetLeft,s=e.touches[0].clientY-n.offsetTop;console.log(i),console.log(s),document.ontouchmove=function(e){var t=(e=e||window.event).touches[0].clientX-i,o=e.touches[0].clientY-s;t<=0?n.style.left=0:t>=document.documentElement.clientWidth-n.clientWidth?n.style.left=document.documentElement.clientWidth-n.clientWidth+"px":n.style.left=t+"px",o<=0?n.style.top=0:o>=document.documentElement.clientHeight-n.clientHeight?n.style.top=document.documentElement.clientHeight-n.clientHeight+"px":n.style.top=o+"px"},document.ontouchend=function(){document.ontouchmove=null,$("#close").bind("click",r)}},$("#Interactive").css("display","block");var u=setInterval(function(){var n,e=$(".countdown").html();e--,$(".countdown").html(e),0==e&&(clearInterval(u),n="",$(".weixuanzhong").each(function(e,t){var o;$(t).hasClass("xuanzhong")&&(n=$(t).next().html(),o=c.options[e].o_id,s={c_id:JSON.parse(i).c_id,t_id:JSON.parse(i).t_id,q_id:JSON.parse(i).q_id,o_id:o})}),n?(console.log(JSON.stringify(s)),$.ajax({url:"http://livetapi.v114.com/appapi/question/sendanswer",type:"post",dataType:"json",data:JSON.stringify(s),success:function(e){console.log(e),"true"==e.state.msg?($("#correctAnswer").css("display","block"),setTimeout(function(){$("#correctAnswer").css("display","none"),$("#Interactive").css("display","none"),$("#close").trigger("click")},4e3)):(continueAnswer=!1,$("#errorAnswer").css("display","block"),setTimeout(function(){$("#errorAnswer").css("display","none"),$("#Interactive").css("display","none"),$("#close").trigger("click")},4e3))},error:function(e){console.log(e)}})):continueAnswer?(continueAnswer=!1,$("#errorAnswer").css("display","block"),setTimeout(function(){$("#errorAnswer").css("display","none"),$("#Interactive").css("display","none"),$("#close").trigger("click")},4e3)):$("#close").trigger("click"))},1e3)}}function onMsgNotify(e){for(var t in e)handlderMsg(e[t])}function handlderMsg(e){var t,o,n,i,s=e.getFromAccount();switch(s=s||"",t=(t=e.getFromAccountNick())||s,o=e.getSession().type(),n=e.getSubType(),o){case webim.SESSION_TYPE.C2C:switch(n){case webim.C2C_MSG_SUB_TYPE.COMMON:i=convertMsgtoHtml(e),webim.Log.warn("receive a new c2c msg: fromAccountNick="+t+", content="+i);var r={To_Account:s,LastedMsgTime:e.getTime()};webim.c2CMsgReaded(r),showTip("收到一条c2c消息(好友消息或者全员推送消息): 发送人="+t+", 内容="+i)}break;case webim.SESSION_TYPE.GROUP:}}function sdkLogin(){webim.login(loginInfo,listeners,options,function(){webim.Log.info("webim登录成功"),applyJoinBigGroup(avChatRoomId),hideDiscussForm(),initEmotionUL()},function(e){console.log(e.ErrorInfo)})}function applyJoinBigGroup(t){var e={GroupId:t};webim.applyJoinBigGroup(e,function(e){e.JoinedStatus&&"JoinedSuccess"==e.JoinedStatus?(webim.Log.info("进群成功"),selToID=t):showTip("进群失败")},function(e){showTip(e.ErrorInfo)})}function showHistoryBeforeMsg(e){var t,o,n,i,s,r,c,a,l,m=e.fromAccount;m=m||"",t=(t=e.fromAccountNick?e.fromAccountNick:m)||"未知用户",o=$("#video_sms_list"),n=document.createElement("li"),(i=document.createElement("div")).setAttribute("class","video-sms-pane"),(s=document.createElement("div")).setAttribute("class","video-sms-text"),r=document.createElement("span");var d=["red","green","blue","org"],u=d[Math.round(m.length%d.length)];r.setAttribute("title",t),r.setAttribute("class","user-name-"+u),r.innerHTML=webim.Tool.formatText2Html(""+t),(c=document.createElement("span")).innerHTML=convertHistoryMsgtoHtml(e),(l=document.createElement("span")).setAttribute("title","举报"),l.setAttribute("class","user-name-report"),(a=document.createElement("span")).setAttribute("class","time-right"),a.innerHTML=formatDate(1e3*e.time),s.appendChild(r),s.appendChild(c),s.appendChild(l),s.appendChild(a),i.appendChild(s),n.appendChild(i),o.prepend(n)}function showHistoryMsg(e){var t,o,n,i,s,r,c,a,l,m=e.fromAccount;m=m||"",t=(t=e.fromAccountNick?e.fromAccountNick:m)||"未知用户",o=document.getElementById("video_sms_list"),n=document.createElement("li"),(i=document.createElement("div")).setAttribute("class","video-sms-pane"),(s=document.createElement("div")).setAttribute("class","video-sms-text"),r=document.createElement("span");var d=["red","green","blue","org"],u=d[Math.round(m.length%d.length)];r.setAttribute("title",t),r.setAttribute("class","user-name-"+u),r.innerHTML=webim.Tool.formatText2Html(""+t),(c=document.createElement("span")).innerHTML=convertHistoryMsgtoHtml(e),(l=document.createElement("span")).setAttribute("title","举报"),l.setAttribute("class","user-name-report"),(a=document.createElement("span")).setAttribute("class","time-right"),a.innerHTML=formatDate(1e3*e.time),s.appendChild(r),s.appendChild(c),s.appendChild(l),s.appendChild(a),i.appendChild(s),n.appendChild(i),o.appendChild(n)}function showMsg(e){var t,o,n,i,s,r,c,a,l,m=e.getFromAccount();m=m||"",t=(t=e.getFromAccountNick())||"未知用户",n=document.getElementById("video_sms_list"),i=document.createElement("li"),(s=document.createElement("div")).setAttribute("class","video-sms-pane"),(r=document.createElement("div")).setAttribute("class","video-sms-text"),c=document.createElement("span");var d=["red","green","blue","org"],u=d[Math.round(m.length%d.length)];switch(c.setAttribute("title",t),c.setAttribute("class","user-name-"+u),c.innerHTML=webim.Tool.formatText2Html(""+t),(l=document.createElement("span")).setAttribute("title","举报"),l.setAttribute("class","user-name-report"),a=document.createElement("span"),contentPage=document.createElement("p"),e.getSession().type(),o=e.getSubType(),e.getIsSend(),o){case webim.GROUP_MSG_SUB_TYPE.COMMON:a.innerHTML=convertMsgtoHtml(e);break;case webim.GROUP_MSG_SUB_TYPE.REDPACKET:a.innerHTML="[群红包消息]"+convertMsgtoHtml(e);break;case webim.GROUP_MSG_SUB_TYPE.LOVEMSG:a.innerHTML="[点赞消息]"+convertMsgtoHtml(e),showLoveMsgAnimation();break;case webim.GROUP_MSG_SUB_TYPE.TIP:a.innerHTML="[群提示消息]"+convertMsgtoHtml(e);break;default:a.innerHTML=e.tipText}var g,p,T,f=formatDate(Date.parse(new Date));(T=document.createElement("span")).setAttribute("class","time-right"),T.innerHTML=f,contentPage.appendChild(a),r.appendChild(c),r.appendChild(contentPage),r.appendChild(l),r.appendChild(T),s.appendChild(r),i.appendChild(s),e.elems[0].content.text&&-1<e.elems[0].content.text.search("&quot;CMD&quot;:&quot;RecommandProduct&quot;")?(console.log("CMDDCDMDMDMDMDM"),e=JSON.parse(e.elems[0].content.text.replace(/&quot;/g,'"')),console.log(e),console.log(e.product),p='<span title="'+(g=JSON.parse(e.product).title?JSON.parse(e.product).title:"")+'" data-href="'+(JSON.parse(e.product).content?JSON.parse(e.product).content:"")+'">'+g+"</span>",$("#promoteProduct").empty(),$("#promoteProduct").html(p),$("#promoteProduct").show(),$(".closeProduct").show()):n.appendChild(i),e.elems[0].content.text&&-1<e.elems[0].content.text.search("&quot;CMD&quot;:&quot;question&quot;")&&(e=JSON.parse(e.elems[0].content.text.replace(/&quot;/g,'"')),console.log(e),console.log(e.sendQuestion));var h=document.getElementById("video_sms_list").scrollHeight;$(".video-comment-content").animate({scrollTop:h},300)}function showMsgTopCache(e){var t,o,n,i,s,r,c,a,l=e.fromAccount;l=l||"",t=(t=e.fromAccountNick)||"未知用户",e.elems[0].content.text&&(e.elems[0].content.text=e.elems[0].content.text.replace(/((http:\/\/|https:\/\/)[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/gi,"<a href='$1' target='_blank'>$1</a>")),o=document.getElementById("video_sms_list"),n=document.createElement("li"),(i=document.createElement("div")).setAttribute("class","video-sms-pane"),(s=document.createElement("div")).setAttribute("class","video-sms-text"),r=document.createElement("span");var m=["red","green","blue","org"],d=m[Math.round(l.length%m.length)];r.setAttribute("title",t),r.setAttribute("class","user-name-"+d),r.innerHTML=webim.Tool.formatText2Html(""+t),(a=document.createElement("span")).setAttribute("title","举报"),a.setAttribute("class","user-name-report"),(c=document.createElement("span")).innerHTML=convertHistoryMsgtoHtml(e);var u,g=formatDate(Date.parse(new Date));(u=document.createElement("span")).setAttribute("class","time-right"),u.innerHTML=g,s.appendChild(r),s.appendChild(c),s.appendChild(a),s.appendChild(u),i.appendChild(s),n.appendChild(i),"undefined"!=typeof imMsgTopFlag&&imMsgTopFlag?($("#msg-top").empty(),$("#msg-top").append(n),$("#msg-top").show()):o.appendChild(n),console.log(imMsgTopFlag),$(".video-comment-content").mCustomScrollbar("scrollTo","bottom",{scrollInertia:300})}function convertHistoryMsgtoHtml(e){var t,o,n,i="",s=e.elems;for(var r in s)switch(o=(t=s[r]).type,n=t.content,o){case webim.MSG_ELEMENT_TYPE.TEXT:i+=convertHistoryTextMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.FACE:i+=convertHistoryFaceMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.IMAGE:i+=convertImageMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.SOUND:i+=convertSoundMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.FILE:i+=convertFileMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.LOCATION:break;case webim.MSG_ELEMENT_TYPE.CUSTOM:i+=convertCustomMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.GROUP_TIP:i+=convertGroupTipMsgToHtml(n);break;default:webim.Log.error("未知消息元素类型: elemType="+o)}return webim.Tool.formatHtml2Text(i)}function convertMsgtoHtml(e){var t,o,n,i="",s=e.getElems();for(var r in s)switch(o=(t=s[r]).getType(),n=t.getContent(),o){case webim.MSG_ELEMENT_TYPE.TEXT:i+=convertTextMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.FACE:i+=convertFaceMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.IMAGE:i+=convertImageMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.SOUND:i+=convertSoundMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.FILE:i+=convertFileMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.LOCATION:break;case webim.MSG_ELEMENT_TYPE.CUSTOM:i+=convertCustomMsgToHtml(n);break;case webim.MSG_ELEMENT_TYPE.GROUP_TIP:i+=convertGroupTipMsgToHtml(n);break;default:webim.Log.error("未知消息元素类型: elemType="+o)}return webim.Tool.formatHtml2Text(i)}function convertHistoryTextMsgToHtml(e){return e.text}function convertTextMsgToHtml(e){return e.getText()}function convertHistoryFaceMsgToHtml(e){var t=null,o=e.data,n=webim.EmotionDataIndexs[o],i=webim.Emotions[n];return i&&i[1]&&(t=i[1]),t?"<img src='"+t+"'/>":o}function convertFaceMsgToHtml(e){var t=null,o=e.getData(),n=webim.EmotionDataIndexs[o],i=webim.Emotions[n];return i&&i[1]&&(t=i[1]),t?"<img src='"+t+"'/>":o}function convertImageMsgToHtml(e){var t=e.getImage(webim.IMAGE_TYPE.SMALL),o=(o=e.getImage(webim.IMAGE_TYPE.LARGE))||t,n=(n=e.getImage(webim.IMAGE_TYPE.ORIGIN))||t;return"<img src='"+t.getUrl()+"#"+o.getUrl()+"#"+n.getUrl()+"' style='CURSOR: hand' id='"+e.getImageId()+"' bigImgUrl='"+o.getUrl()+"' onclick='imageClick(this)' />"}function convertSoundMsgToHtml(e){e.getSecond();var t=e.getDownUrl();return"ie"==webim.BROWSER_INFO.type&&parseInt(webim.BROWSER_INFO.ver)<=8?"[这是一条语音消息]demo暂不支持ie8(含)以下浏览器播放语音,语音URL:"+t:'<audio src="'+t+'" controls="controls" onplay="onChangePlayAudio(this)" preload="none"></audio>'}function convertFileMsgToHtml(e){var t=Math.round(e.getSize()/1024);return'<a href="'+e.getDownUrl()+'" title="点击下载文件" ><i class="glyphicon glyphicon-file">&nbsp;'+e.getName()+"("+t+"KB)</i></a>"}function convertLocationMsgToHtml(e){return"经度="+e.getLongitude()+",纬度="+e.getLatitude()+",描述="+e.getDesc()}function convertCustomMsgToHtml(e){return"data="+e.getData()+", desc="+e.getDesc()+", ext="+e.getExt()}function convertGroupTipMsgToHtml(e){var t,o,n="",i=e.getOpType(),s=e.getOpUserId();switch(i){case webim.GROUP_TIP_TYPE.JOIN:for(var r in t=e.getUserIdList())if(n+=t[r]+",",10<t.length&&9==r){n+="等"+t.length+"人";break}n=n.substring(0,n.length-1),n+="进入房间",o=$("#user-icon-fans").html(),$("#user-icon-fans").html(parseInt(o)+1);break;case webim.GROUP_TIP_TYPE.QUIT:n+=s+"离开房间",0<(o=parseInt($("#user-icon-fans").html()))&&$("#user-icon-fans").html(o-1);break;case webim.GROUP_TIP_TYPE.KICK:for(var r in n+=s+"将",t=e.getUserIdList())if(n+=t[r]+",",10<t.length&&9==r){n+="等"+t.length+"人";break}n+="踢出该群";break;case webim.GROUP_TIP_TYPE.SET_ADMIN:for(var r in n+=s+"将",t=e.getUserIdList())if(n+=t[r]+",",10<t.length&&9==r){n+="等"+t.length+"人";break}n+="设为管理员";break;case webim.GROUP_TIP_TYPE.CANCEL_ADMIN:for(var r in n+=s+"取消",t=e.getUserIdList())if(n+=t[r]+",",10<t.length&&9==r){n+="等"+t.length+"人";break}n+="的管理员资格";break;case webim.GROUP_TIP_TYPE.MODIFY_GROUP_INFO:n+=s+"修改了群资料：";var c,a,l=e.getGroupInfoList();for(var r in l)switch(c=l[r].getType(),a=l[r].getValue(),c){case webim.GROUP_TIP_MODIFY_GROUP_INFO_TYPE.FACE_URL:n+="群头像为"+a+"; ";break;case webim.GROUP_TIP_MODIFY_GROUP_INFO_TYPE.NAME:n+="群名称为"+a+"; ";break;case webim.GROUP_TIP_MODIFY_GROUP_INFO_TYPE.OWNER:n+="群主为"+a+"; ";break;case webim.GROUP_TIP_MODIFY_GROUP_INFO_TYPE.NOTIFICATION:n+="群公告为"+a+"; ";break;case webim.GROUP_TIP_MODIFY_GROUP_INFO_TYPE.INTRODUCTION:n+="群简介为"+a+"; ";break;default:n+="未知信息为:type="+c+",value="+a+"; "}break;case webim.GROUP_TIP_TYPE.MODIFY_MEMBER_INFO:n+=s+"修改了群成员资料:";var m,d=e.getMemberInfoList();for(var r in d)if(n+=d[r].getUserId()+": ",n+=null!=(m=d[r].getShutupTime())&&void 0!==m?0==m?"取消禁言; ":"禁言"+m+"秒; ":" shutupTime为空",10<d.length&&9==r){n+="等"+d.length+"人";break}break;default:n+="未知群提示消息类型：type="+i}return n}function tlsLogin(){TLSHelper.goLogin({sdkappid:loginInfo.sdkAppID,acctype:loginInfo.accountType,url:window.location.href})}function tlsGetUserSig(e){var t;e.ErrorCode==webim.TLS_ERROR_CODE.OK?(loginInfo.identifier=webim.Tool.getQueryString("identifier"),loginInfo.userSig=e.UserSig,loginInfo.sdkAppID=loginInfo.appIDAt3rd=Number(webim.Tool.getQueryString("sdkappid")),(t=webim.Tool.getCookie("accountType"))?(loginInfo.accountType=t,sdkLogin()):location.href=location.href.replace(/\?.*$/gi,"")):e.ErrorCode==webim.TLS_ERROR_CODE.SIGNATURE_EXPIRATION?tlsLogin():alert("["+e.ErrorCode+"]"+e.ErrorInfo)}function imageClick(e){var t=e.src.split("#"),o=t[0],n=t[1],i=t[2];webim.Log.info("小图url:"+o),webim.Log.info("大图url:"+n),webim.Log.info("原图url:"+i)}function onChangePlayAudio(e){curPlayAudio?curPlayAudio!=e&&(curPlayAudio.currentTime=0,curPlayAudio.pause(),curPlayAudio=e):curPlayAudio=e}function smsPicClick(){loginInfo.identifier?(hideDiscussTool(),showDiscussForm()):1==accountMode?(webim.Tool.setCookie("accountType",loginInfo.accountType,86400),tlsLogin()):showTip("请填写帐号和票据")}function onSendMsg(){if(loginInfo.identifier){if(!selToID)return showTip("您还没有进入房间，暂不能聊天"),void $("#send_msg_text").val("");var e=$("#send_msg_text").val().replace(/(^\s*)|(\s*$)/g,"");$("#send_msg_text").val("");var t,o,n=webim.Tool.getStrBytes(e);if(e.length<1)return showTip("发送的消息不能为空!"),!1;if(o=(t=selType==webim.SESSION_TYPE.GROUP?webim.MSG_MAX_LENGTH.GROUP:webim.MSG_MAX_LENGTH.C2C,"消息长度超出限制(最多"+Math.round(t/3)+"汉字)"),t<n)showTip(o);else if($.ajax({type:"post",url:filterurl,data:JSON.stringify({content:e,topicid:tid,nickname:loginInfo.identifierNick}),dataType:"json",async:!1,success:function(e){filterVal=!0,0!=e.state&&(filterVal=!1,alert(e.msg))}}),filterVal){selSess=selSess||new webim.Session(selType,selToID,selToID,selSessHeadUrl,Math.round((new Date).getTime()/1e3));var i,s,r,c,a,l=Math.round(4294967296*Math.random()),m=Math.round((new Date).getTime()/1e3),d=selType==webim.SESSION_TYPE.GROUP?webim.GROUP_MSG_SUB_TYPE.COMMON:webim.C2C_MSG_SUB_TYPE.COMMON,u=new webim.Msg(selSess,!0,-1,l,m,loginInfo.identifier,d,loginInfo.identifierNick),g=e.match(/\[[^[\]]{1,3}\]/gm);if(!g||g.length<1)i=new webim.Msg.Elem.Text(e),u.addText(i);else{for(var p=0;p<g.length;p++)(r=e.substring(0,e.indexOf(g[p])))&&(i=new webim.Msg.Elem.Text(r),u.addText(i)),c=webim.EmotionDataIndexs[g[p]],webim.Emotions[c]?(s=new webim.Msg.Elem.Face(c,g[p]),u.addFace(s)):(i=new webim.Msg.Elem.Text(g[p]),u.addText(i)),a=e.indexOf(g[p])+g[p].length,e=e.substring(a);e&&(i=new webim.Msg.Elem.Text(e),u.addText(i))}webim.sendMsg(u,function(e){selType==webim.SESSION_TYPE.C2C&&showMsg(u),webim.Log.info("发消息成功"),$.ajax({type:"POST",url:tourl,data:JSON.stringify({msg:JSON.stringify(u),fromaccount:loginInfo.identifierNick,topicid:selToID,dottime:"0:00",type:1}),dataType:"json",success:function(){}}),hideDiscussForm(),showDiscussTool(),hideDiscussEmotion()},function(e){webim.Log.error("发消息失败:"+e.ErrorInfo),showTip("发消息失败!")})}}else 1==accountMode?(webim.Tool.setCookie("accountType",loginInfo.accountType,86400),tlsLogin()):showTip("请填写帐号和票据")}function sendGroupLoveMsg(){var e,t,o,n,i;loginInfo.identifier?selToID?(selSess=selSess||new webim.Session(selType,selToID,selToID,selSessHeadUrl,Math.round((new Date).getTime()/1e3)),e=Math.round(4294967296*Math.random()),t=Math.round((new Date).getTime()/1e3),o=webim.GROUP_MSG_SUB_TYPE.LOVEMSG,n=new webim.Msg(selSess,!0,-1,e,t,loginInfo.identifier,o,loginInfo.identifierNick),i=new webim.Msg.Elem.Text(" 点了一个赞哦"),n.addText(i),webim.sendMsg(n,function(e){selType==webim.SESSION_TYPE.C2C&&showMsg(n),webim.Log.info("点赞成功")},function(e){webim.Log.error("发送点赞消息失败:"+e.ErrorInfo),showTip("发送点赞消息失败:"+e.ErrorInfo)})):showTip("您还没有进入房间，暂不能点赞"):1==accountMode?(webim.Tool.setCookie("accountType",loginInfo.accountType,86400),tlsLogin()):showTip("请填写帐号和票据")}function hideDiscussForm(){$(".video-discuss-form").show()}function showDiscussForm(){$(".video-discuss-form").show()}function hideDiscussTool(){$(".video-discuss-tool").hide()}function showDiscussTool(){$(".video-discuss-tool").hide()}function hideDiscussEmotion(){$(".video-discuss-emotion").hide()}function showDiscussEmotion(){$(".video-discuss-emotion").show()}function showLoveMsgAnimation(){var e=$("#likeNumber").html();$("#likeNumber").html(parseInt(e)+1)}function initEmotionUL(){for(var e in webim.Emotions){var t=$("<img>").attr({id:webim.Emotions[e][0],src:webim.Emotions[e][1],style:"cursor:pointer;"}).click(function(){selectEmotionImg(this)});$("<li>").append(t).appendTo($("#emotionUL"))}}function showEmotionDialog(){openEmotionFlag?(openEmotionFlag=!1,hideDiscussEmotion()):(openEmotionFlag=!0,showDiscussEmotion())}function selectEmotionImg(e){$("#send_msg_text").val($("#send_msg_text").val()+e.id)}function quitBigGroup(){var e={GroupId:avChatRoomId};webim.quitBigGroup(e,function(e){webim.Log.info("退群成功"),$("#video_sms_list").find("li").remove()},function(e){showTip(e.ErrorInfo)})}function logout(){webim.logout(function(e){webim.Log.info("登出成功"),loginInfo.identifier=null,loginInfo.userSig=null,$("#video_sms_list").find("li").remove();var t=window.location.href,o=t.indexOf("?");0<=o&&(t=t.substring(0,o)),window.location.href=t})}function independentModeLogin(){0!=$("#login_account").val().length?0!=$("#login_pwd").val().length?(loginInfo.identifier=$("#login_account").val(),loginInfo.userSig=$("#login_pwd").val(),$("#login_dialog").hide(),sdkLogin()):showTip("请输入UserSig"):showTip("请输入帐号")}function add0(e){return e<10?"0"+e:e}function formatDate(e){var t=new Date(e),o=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),s=t.getHours(),r=t.getMinutes(),c=t.getSeconds();return o+"-"+add0(n)+"-"+add0(i)+" "+add0(s)+":"+add0(r)+":"+add0(c)}