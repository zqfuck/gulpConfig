!function(factory){if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){var target=module["exports"]||exports;factory(target)}else{if(typeof define==="function"&&define["amd"]){define(["exports"],factory)}else{factory(window["zhixinHybrid"]={})}}}(function(zhixinExports){var zhixinHybrid=typeof zhixinExports!=="undefined"?zhixinExports:{};localStorage.clear();localStorage.prepared=false;zhixinHybrid.isAvailable=function isAvailable(tagName){if(!tagName){return false}return localStorage.prepared&&window.zhixin&&window.zhixin[tagName]&&typeof window.zhixin[tagName]==="function"};zhixinHybrid.requestHybridToZHIXIN=function requestHybridToZHIXIN(params){if(!localStorage.prepared){console.log("客户端未加载完成，请稍后再试！");return}if(!params.tagname){console.log("必须包含tagname");return}var tagname=params.tagname.substr(0,params.tagname.indexOf("("));if(params.callback){if(!typeof params.callback==="function"){console.error("回调函数不是一个function");return}var _random_tagname=tagname+"_"+RandomTagName();var reg=/([^:]\/{2,}.*?(\r|\n))/g;var callbackStr=params.callback.toString().replace(reg,"").replace(/\n/g,"");console.log(callbackStr);localStorage.setItem(_random_tagname,callbackStr);var _callbackFun=_random_tagname;params.callback=tagname;zhixinHybrid._addHybridParamWiThCallBack(tagname,params,_callbackFun)}else{zhixinHybrid._addHybridParam(tagname,params)}};zhixinHybrid._addHybridParam=function _addHybridParam(tag,params,callback){var tagname=params.tagname;var re=/\([^\)]+\)/g;var attrs=tagname.match(re);if(!attrs){return zhixinHybrid._request(tag)}attrs=attrs[0];attrs=attrs.substring(1,attrs.length-1).split(",");if(attrs.length>0){if(!params.param){console.log("当前方法需要传递参数！");return}else{var key,counter=0;for(key in params.param){counter++}if(attrs.length!=counter){console.log("当前方法需要传递参数个数与实际传入的个数不符！");return}}}if(attrs.length==1){return zhixinHybrid._request(tag,params.param[attrs[0]])}else{if(attrs.length==2){return zhixinHybrid._request(tag,params.param[attrs[0]],params.param[attrs[1]])}else{console.error("投递参数不合法！");return}}};zhixinHybrid._addHybridParamWiThCallBack=function _addHybridParamWiThCallBack(tag,params,callback){var tagname=params.tagname;var re=/\([^\)]+\)/g;var attrs=tagname.match(re);if(!attrs){return zhixinHybrid._requestWithCallBack(tag,callback)}attrs=attrs[0];attrs=attrs.substring(1,attrs.length-1).split(",");if(attrs.length>0){if(!params.param){console.error("当前方法需要传递参数！");return}else{var key,counter=0;for(key in params.param){counter++}if(attrs.length!=counter){console.error("当前方法需要传递参数个数与实际传入的个数不符！");return}}}if(attrs.length==1){return zhixinHybrid._requestWithCallBack(tag,callback,params.param[attrs[0]])}else{if(attrs.length==2){return zhixinHybrid._requestWithCallBack(tag,callback,params.param[attrs[0]],params.param[attrs[1]])}else{console.error("投递参数不合法！");return}}};zhixinHybrid._requestWithCallBack=function _requestWithCallBack(tagname,callback,param1,param2){if(!param1&&!param2){window.zhixin[tagname](callback)}if(param1&&!param2){window.zhixin[tagname](callback,param1)}if(param1&&param2){window.zhixin[tagname](callback,param1,param2)}};zhixinHybrid._request=function zhixinHybrid(tagname,param1,param2){if(!param1&&!param2){window.zhixin[tagname]()}if(param1&&!param2){window.zhixin[tagname](param1)}if(param1&&param2){window.zhixin[tagname](param1,param2)}};window.onZhiXinLoad=function(){localStorage.prepared=true;window.afterZhiXinLoad&&window.afterZhiXinLoad()};window.RandomTagName=function(){var str="abcdefghijklmnopqrstuvwxyz";var n=5,s="";for(var i=0;i<n;i++){var rand=Math.floor(Math.random()*str.length);s+=str.charAt(rand)}var time=new Date().getTime();return s+"_"+time};window.callbackExec=function(result){console.log("中转方法:"+typeof result);if(result.callback==="onZhiXinLoad"){window.onZhiXinLoad();return}var callbackStr=localStorage.getItem(result.callback);console.log("callbackStr:"+callbackStr);console.log("localStorage length:"+localStorage.length);try{var finalFuncStr="("+callbackStr+")("+JSON.stringify(result)+")";console.log("exec: "+finalFuncStr);var callbackFunc=eval(finalFuncStr)}catch(e){alert("sid获取错误:"+e.message)}};window.callback=function(result){console.log("返回结果:"+JSON.stringify(result));if(result&&result.callback){window.callbackExec(result)}else{console.log("callback not found")}};window.test=1;window.tmpFn={};window.bindTime=new Date().toString();window.onerror=function(err,url,num){console.log("第"+num+"行\n"+err+"\n bindTime:"+window.bindTime)};return zhixinHybrid});