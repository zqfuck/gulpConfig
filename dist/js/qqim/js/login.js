"use strict";var feed=location.host.split(".")[0],host=window.location.protocol+"//"+feed+"api.v114.com",tourl=host+"/msg/history",filterurl=host+"/msg/filterwords",nick_url="/mediacloud/default/nickname-pool",getnickname=host+"/getnickname",firstEnter=!0,ismousewheel=!0,loadedAll=!1;function mousewheelHander(e){e.stopPropagation(),e.preventDefault(),0==document.getElementById("chat-list-div").scrollTop&&1==ismousewheel&&(document.getElementById("slideDown2").style.display="block",getHistoryMsg(window.switch.page),window.switch.page+=1,msgflag=2,ismousewheel=!1)}function getHistoryMsg(e){var o=host+"/webapi/banner/msg-list?topicid="+tid+"&page="+e;setTimeout(function(){document.getElementById("slideDown2").style.display="none";var e=document.getElementById("more"),i=document.getElementById("all");loadedAll?(e.style.display="none",i.style.display="block"):(i.style.display="none",e.style.display="block"),$.getJSON(o,function(e){0==e.state?initHistoryMsg(e.data,!0):-2==e.state&&(loadedAll=!0)})},1e3)}window.switch={flag:!0,page:2};var headurl,identifier,identifierNick,userSig,filterVal,accountMode=0,sdkAppID="1400038608",accountType="15000",avChatRoomId=tid,media_id=2;webim.Tool.getQueryString("tid")&&(avChatRoomId=webim.Tool.getQueryString("tid")),webim.Tool.getQueryString("photo")&&(headurl=webim.Tool.getQueryString("photo"));var selType=webim.SESSION_TYPE.GROUP,selToID=avChatRoomId,selSess=null,selSessHeadUrl="img/2017.jpg",loginInfo={sdkAppID:sdkAppID,appIDAt3rd:sdkAppID,accountType:accountType,identifier:identifier,identifierNick:identifierNick,userSig:userSig,headurl:headurl||"img/2016.gif"},onGroupSystemNotifys={5:onDestoryGroupNotify,11:onRevokeGroupNotify,255:onCustomGroupNotify},onConnNotify=function(e){switch(e.ErrorCode){case webim.CONNECTION_STATUS.ON:break;case webim.CONNECTION_STATUS.OFF:webim.Log.warn("连接已断开，无法收到新消息，请检查下你的网络是否正常");break;default:webim.Log.error("未知连接状态,status="+e.ErrorCode)}},listeners={onConnNotify:onConnNotify,jsonpCallback:jsonpCallback,onBigGroupMsgNotify:onBigGroupMsgNotify,onMsgNotify:onMsgNotify,onGroupSystemNotifys:onGroupSystemNotifys,onGroupInfoChangeNotify:onGroupInfoChangeNotify},isAccessFormalEnv=!0;"false"==webim.Tool.getQueryString("isAccessFormalEnv")&&(isAccessFormalEnv=!1);var isLogOn=!1,options={isAccessFormalEnv:isAccessFormalEnv,isLogOn:isLogOn},curPlayAudio=null,openEmotionFlag=!1,entryUrl=host+"/msg/history/entry",getIdentifier=host+"/webapi/msg/randomname";function colseLogin(){$("#login_dialog").hide()}$.getJSON(getIdentifier,function(e){0==e.state?$("#nickname_dialog .nickname").val(e.identifierNick):showTip("IM_Idnetifier_Error")}),/debug/gi.test(location.hash)&&document.write('<script src="http://sdklog.isd.com/js/vconsole.min.js"><\/script>'),$(function(){$(".video-comment-content").on("scroll",mousewheelHander);var e=host+"/webapi/banner/msg-list?topicid="+tid;$.getJSON(e,function(e){console.log(e),0==e.state&&initHistoryMsg(e.data,!1)}),$("#send_msg_text").keydown(function(e){if(13==e.keyCode)return $(".video-discuss-button").click(),$(this).blur(),!1}),$("#emotionUL").on("click","li>img",function(){$(".video-discuss-face").click()}),$("#send_msg_text").focus(function(){$("#video-discuss-form .voteCon").hide(),$("#video-discuss-emotion").is(":visible")&&$(".video-discuss-face").click()}),$(document).click(function(e){var i=$(".video-discuss-pane");i.is(e.target)||0!==i.has(e.target).length||(0<!$("#send_msg_text").val().length&&$("#video-discuss-form .voteCon").show(),$("#video-discuss-emotion").is(":visible")&&$(".video-discuss-face").click())}),$("#nickname_dialog .login_discuss").click(function(){$("#nickname_dialog .nickname_input").slideToggle("fast")}),$("#nickname_dialog .nickname-button").click(function(){var e=$("#nickname_dialog .nickname").val();$.ajax({type:"get",url:entryUrl,data:{nickname:e},dataType:"json",async:!1,success:function(e){0==e.state?(loginInfo.sdkAppID=e.sdkAppID,loginInfo.appIDAt3rd=e.sdkAppID,loginInfo.accountType=e.accountType,loginInfo.userSig=e.userSig,loginInfo.identifier=e.identifier,loginInfo.identifierNick=e.identifierNick):console.log(e.msg)}}),sdkLogin(),$("#nickname_dialog").hide()})});